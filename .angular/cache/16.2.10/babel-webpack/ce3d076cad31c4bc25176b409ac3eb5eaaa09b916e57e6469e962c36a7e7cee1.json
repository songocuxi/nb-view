{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { catchError, tap, throwError } from 'rxjs';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"src/app/core/services/toast-box-modal.service\";\nimport * as i4 from \"src/app/core/services/local-storage.service\";\nexport class AuthenticationService {\n  constructor(httpClient, router, toastSV, localStorageSV) {\n    this.httpClient = httpClient;\n    this.router = router;\n    this.toastSV = toastSV;\n    this.localStorageSV = localStorageSV;\n    this.userId = '';\n  }\n  signIn(account) {\n    let api = environment.url + 'user/login';\n    let accountCode = btoa(account.username + ':' + account.password);\n    let header = new HttpHeaders().set('Authorization', `Basic ${accountCode}`);\n    return this.httpClient.get(api, {\n      headers: header\n    }).pipe(tap(data => {\n      this.localStorageSV.setItem('name', data.username);\n      this.localStorageSV.setItem('userId', data.userId);\n      this.userId = data.userId;\n      this.router.navigateByUrl('/farmer/process/list');\n      this.toastSV.sendMessage({\n        isDisplay: true,\n        message: 'Đăng nhập thành công',\n        icon: 'success'\n      });\n    }), catchError(() => {\n      this.toastSV.sendMessage({\n        isDisplay: true,\n        message: 'Lỗi. VUi lòng thử lại sau!',\n        icon: 'error'\n      });\n    }));\n  }\n  logOut() {\n    this.router.navigateByUrl('/sign-in');\n  }\n  handleError(error) {\n    if (error.status === 0) {\n      console.error('An error occurred:', error.error);\n    } else {\n      console.error(`Backend returned code ${error.status}, body was: `, error.error);\n    }\n    return throwError(() => new Error('Something bad happened; please try again later.'));\n  }\n  static #_ = this.ɵfac = function AuthenticationService_Factory(t) {\n    return new (t || AuthenticationService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.ToastBoxModalService), i0.ɵɵinject(i4.LocalStorageService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthenticationService,\n    factory: AuthenticationService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["HttpHeaders","catchError","tap","throwError","environment","AuthenticationService","constructor","httpClient","router","toastSV","localStorageSV","userId","signIn","account","api","url","accountCode","btoa","username","password","header","set","get","headers","pipe","data","setItem","navigateByUrl","sendMessage","isDisplay","message","icon","logOut","handleError","error","status","console","Error","_","i0","ɵɵinject","i1","HttpClient","i2","Router","i3","ToastBoxModalService","i4","LocalStorageService","_2","factory","ɵfac","providedIn"],"sources":["D:\\hoc\\mon\\LV\\Làm\\New folder\\nb-view\\src\\app\\feature\\authentication\\service\\authentication.service.ts"],"sourcesContent":["import {\r\n  HttpClient,\r\n  HttpErrorResponse,\r\n  HttpHeaders,\r\n} from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { catchError, tap, throwError } from 'rxjs';\r\nimport { LocalStorageService } from 'src/app/core/services/local-storage.service';\r\nimport { ToastBoxModalService } from 'src/app/core/services/toast-box-modal.service';\r\nimport { environment } from 'src/environments/environment';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class AuthenticationService {\r\n  userId: string = '';\r\n\r\n  constructor(\r\n    private httpClient: HttpClient,\r\n    private router: Router,\r\n    private toastSV: ToastBoxModalService,\r\n    private localStorageSV: LocalStorageService\r\n  ) {}\r\n\r\n  signIn(account: any) {\r\n    let api: string = environment.url + 'user/login';\r\n    let accountCode = btoa(account.username + ':' + account.password);\r\n    let header = new HttpHeaders().set('Authorization', `Basic ${accountCode}`);\r\n    return this.httpClient.get(api, { headers: header }).pipe(\r\n      tap((data: any) => {\r\n        this.localStorageSV.setItem('name', data.username);\r\n        this.localStorageSV.setItem('userId', data.userId)\r\n        this.userId = data.userId;\r\n        this.router.navigateByUrl('/farmer/process/list');\r\n        this.toastSV.sendMessage({\r\n          isDisplay: true,\r\n          message: 'Đăng nhập thành công',\r\n          icon: 'success',\r\n        });\r\n      }),\r\n      catchError((): any => {\r\n        this.toastSV.sendMessage({\r\n          isDisplay: true,\r\n          message: 'Lỗi. VUi lòng thử lại sau!',\r\n          icon: 'error',\r\n        });\r\n      })\r\n    );\r\n  }\r\n\r\n  logOut() {\r\n    this.router.navigateByUrl('/sign-in');\r\n  }\r\n\r\n  private handleError(error: HttpErrorResponse) {\r\n    if (error.status === 0) {\r\n      console.error('An error occurred:', error.error);\r\n    } else {\r\n      console.error(\r\n        `Backend returned code ${error.status}, body was: `,\r\n        error.error\r\n      );\r\n    }\r\n    return throwError(\r\n      () => new Error('Something bad happened; please try again later.')\r\n    );\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAGEA,WAAW,QACN,sBAAsB;AAG7B,SAASC,UAAU,EAAEC,GAAG,EAAEC,UAAU,QAAQ,MAAM;AAGlD,SAASC,WAAW,QAAQ,8BAA8B;;;;;;AAK1D,OAAM,MAAOC,qBAAqB;EAGhCC,YACUC,UAAsB,EACtBC,MAAc,EACdC,OAA6B,EAC7BC,cAAmC;IAHnC,KAAAH,UAAU,GAAVA,UAAU;IACV,KAAAC,MAAM,GAANA,MAAM;IACN,KAAAC,OAAO,GAAPA,OAAO;IACP,KAAAC,cAAc,GAAdA,cAAc;IANxB,KAAAC,MAAM,GAAW,EAAE;EAOhB;EAEHC,MAAMA,CAACC,OAAY;IACjB,IAAIC,GAAG,GAAWV,WAAW,CAACW,GAAG,GAAG,YAAY;IAChD,IAAIC,WAAW,GAAGC,IAAI,CAACJ,OAAO,CAACK,QAAQ,GAAG,GAAG,GAAGL,OAAO,CAACM,QAAQ,CAAC;IACjE,IAAIC,MAAM,GAAG,IAAIpB,WAAW,EAAE,CAACqB,GAAG,CAAC,eAAe,EAAE,SAASL,WAAW,EAAE,CAAC;IAC3E,OAAO,IAAI,CAACT,UAAU,CAACe,GAAG,CAACR,GAAG,EAAE;MAAES,OAAO,EAAEH;IAAM,CAAE,CAAC,CAACI,IAAI,CACvDtB,GAAG,CAAEuB,IAAS,IAAI;MAChB,IAAI,CAACf,cAAc,CAACgB,OAAO,CAAC,MAAM,EAAED,IAAI,CAACP,QAAQ,CAAC;MAClD,IAAI,CAACR,cAAc,CAACgB,OAAO,CAAC,QAAQ,EAAED,IAAI,CAACd,MAAM,CAAC;MAClD,IAAI,CAACA,MAAM,GAAGc,IAAI,CAACd,MAAM;MACzB,IAAI,CAACH,MAAM,CAACmB,aAAa,CAAC,sBAAsB,CAAC;MACjD,IAAI,CAAClB,OAAO,CAACmB,WAAW,CAAC;QACvBC,SAAS,EAAE,IAAI;QACfC,OAAO,EAAE,sBAAsB;QAC/BC,IAAI,EAAE;OACP,CAAC;IACJ,CAAC,CAAC,EACF9B,UAAU,CAAC,MAAU;MACnB,IAAI,CAACQ,OAAO,CAACmB,WAAW,CAAC;QACvBC,SAAS,EAAE,IAAI;QACfC,OAAO,EAAE,4BAA4B;QACrCC,IAAI,EAAE;OACP,CAAC;IACJ,CAAC,CAAC,CACH;EACH;EAEAC,MAAMA,CAAA;IACJ,IAAI,CAACxB,MAAM,CAACmB,aAAa,CAAC,UAAU,CAAC;EACvC;EAEQM,WAAWA,CAACC,KAAwB;IAC1C,IAAIA,KAAK,CAACC,MAAM,KAAK,CAAC,EAAE;MACtBC,OAAO,CAACF,KAAK,CAAC,oBAAoB,EAAEA,KAAK,CAACA,KAAK,CAAC;KACjD,MAAM;MACLE,OAAO,CAACF,KAAK,CACX,yBAAyBA,KAAK,CAACC,MAAM,cAAc,EACnDD,KAAK,CAACA,KAAK,CACZ;;IAEH,OAAO/B,UAAU,CACf,MAAM,IAAIkC,KAAK,CAAC,iDAAiD,CAAC,CACnE;EACH;EAAC,QAAAC,CAAA,G;qBApDUjC,qBAAqB,EAAAkC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,MAAA,GAAAL,EAAA,CAAAC,QAAA,CAAAK,EAAA,CAAAC,oBAAA,GAAAP,EAAA,CAAAC,QAAA,CAAAO,EAAA,CAAAC,mBAAA;EAAA;EAAA,QAAAC,EAAA,G;WAArB5C,qBAAqB;IAAA6C,OAAA,EAArB7C,qBAAqB,CAAA8C,IAAA;IAAAC,UAAA,EAFpB;EAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}